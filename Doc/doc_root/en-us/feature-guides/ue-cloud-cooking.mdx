---
id: ue-cloud-cooking
title: Cloud Cooking
slug: /unreal/cloud-cooking
custom_edit_url: https://github.com/modio/modio-ue4-internal/blob/develop/Plugins/Modio/Doc/doc_root/en-us/feature-guides/ue-cloud-cooking.mdx
---

# Cloud Cooking for Unreal

[Cloud Cooking](https://docs.mod.io/cloud-cooking) provides mod.io managed infrastructure that supports preparation of content for platforms that are only available under non-disclosure agreements, such as consoles.

:::note[Premium Feature] Cloud Cooking is a premium feature. Please contact us at developers@mod.io for more information. :::

This feature is fully functional for games utilizing our Unreal Engine Plugin.

This guide covers:

* [Getting Started](#getting-started)
* [Setting up AutoSDKs for all supported platforms](#setting-up-autosdks-for-all-supported-platforms)
* [Adding a BuildGraph script for cooking a piece of content](#add-a-buildgraph-script-for-cooking-a-piece-of-content)
* [Cooking a Base Release for each platform](#cooking-a-base-release-for-each-platform)
* [Uploading your build and AutoSDKs to mod.io](#uploading-your-build-and-autosdks-to-modio)
* [Next steps](#next-steps)

## Getting started

We recommend that you produce an [Installed Build](https://dev.epicgames.com/documentation/en-us/unreal-engine/create-an-installed-build-of-unreal-engine) of your engine and a binary-only build of your game to upload to Cloud Cooking. When uploading these builds, you should avoid including game source code, PDBs, intermediates, and console binaries. You should only include what is necessary to be able to run the editor and cook for each platform that you want to support in your Cloud Cooking configuration.

:::note
The Cloud Cooking process assumes that you are using "DLCs as UGC" for producing & loading UGC within Unreal Engine. The source files being submitted by content creators must be a plugin, containing a uplugin file and all associated assets.
:::

## Provisioning process

Internally, Cloud Cooking runs a set of initialization scripts to prepare the build agent environment for cooking. The build that you upload needs to include these requirements in order for the provisioning process to complete successfully.

:::note
If you need this process customized to include additional configuration for your build, please contact your mod.io account manager.
:::

### Engine Prerequisites

The initialization will install the engine prerequisites from the `Engine/Extras/Redist/en-us` folder. Ensure that this folder is included in your uploaded build.

:::note
This file has a different name depending on what version of Unreal you are on. In older versions of Unreal, this file is named `UEPrereqSetup_x64.exe`. More recent versions name this `vc_redist.x64.exe`. Cloud Cooking will run whichever file it finds in this folder.
:::

### Turnkey Configuration for AutoSDKs

The initialization will also set up all of the AutoSDK configurations for all AutoSDKs that you have included in your build. This is done by running `RunUAT.bat turnkey -Command=InstallSdk -Platform=All -NeededOnly`.

### Testing Your Build

Before uploading your build to Cloud Cooking, we recommend that you test your build locally to ensure that it can successfully cook content for all of the platforms that you want to support. This is best done on a machine running a fresh installation of Windows 11 that does not have Unreal Engine or any AutoSDKs installed.

## Setting up AutoSDKs for all supported platforms

For each platform you want to cook for, you should set up an [AutoSDK](https://dev.epicgames.com/documentation/en-us/unreal-engine/using-the-autosdk-system-in-unreal-engine) configuration. You will have to provide mod.io with the AutoSDK folder - note that this is not your Turnkey folder or configuration, but the actual extracted AutoSDKs.

:::note
The build agents will automatically have the `UE_SDKS_ROOT` environment variable set as part of the provisioning process
:::

:::warning
If you are intending to use Cloud Cooking for GDK-based platforms and are using a version of UE prior to 5.4, you need to incorporate CL 28337709 from Epic's Perforce, or the following GitHub Commit (https://github.com/EpicGames/UnrealEngine/commit/ce4c0b8039a54f8ca841d50ca05dad6e4c018204) to fix a GDK AutoSDK installation issue.
:::

## Add a BuildGraph script for cooking a piece of content

The Cloud Cooking agent will look for a BuildGraph script called `CloudCooking.xml`, located in your game's Build directory, and execute a build step called `CookMod`.

### BuildGraph Script Parameters

The Cloud Cooking agent will automatically pass the following parameters to the `CookMod` BuildGraph script, which should be forwarded on to the appropriate parameters in `BuildCookRun`

| Parameter Name    | BuildCookRun Param | Description |
| -------- | -------- | ------- |
| UProjectPath  | -Project | Path to the uproject of your game.   |
| UGCBuildPlatform | -Platform | Name of the platform that is being cooked for (i.e. PS5®, XSX etc.)     |
| DLCName   | -DLCName | Name/Path of the plugin that is being cooked as a mod   |
| UGCStagingDirectory | -StagingDirectory | Directory to stage the content at.  |

Below is an example of the CloudCooking BuildGraph script that you can use in your project.

```xml
<?xml version='1.0' ?>
<BuildGraph xmlns="http://www.epicgames.com/BuildGraph" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="./Schema.xsd">
    <Option Name="UProjectPath" DefaultValue="" Description="Path to the base project to reference"/>
    <Option Name="UGCBuildPlatform" DefaultValue="Win64" Description="The platform to cook UGC for. Passed by Cloud Cooking Agent"/>
    <Option Name="DLCName" DefaultValue="" Description="Plugin Name of the UGC to build"/>
    <Option Name="UGCStagingDirectory" DefaultValue="" Description="Directory to stage the packged DLC"/>      

    <Agent Name="Default Agent" Type="Default">
        <Node Name="CookMod">
            <Command Name="BuildCookRun" Arguments="-Project=$(UProjectPath) -Platform=$(UGCBuildPlatform) -nocompile -installed -utf8output -nobuild -cook -neverpackage -CookCultures=en -unversionedcookedcontent -pak -stage -basedonreleaseversion=UGCReleaseV1_0 -stagebasereleasepaks -DLCName=$(DLCName) -stagingdirectory=$(UGCStagingDirectory)" />
        </Node>
    </Agent>
</BuildGraph>
```

## Preparing a DDC PAK file

As part of your build process, you should prepare a DDC PAK file which will include all of the derived data required for loading the editor and performing the cooking process. Not including a DDC PAK file will likely result in significantly longer cook times as the build agent may need to re-build derived data every cook.
Note that there are two DDC PAKs that you have to create: an Engine DDC PAK and a Game DDC PAK.

You can create a DDC Game PAK file with the following commandline:
`Engine\Binaries\Win64\UnrealEditor.exe ProjectName -run=DerivedDataCache -fill -DDC=CreatePak`

This will create a .ddp file in the `DerivedDataCache` folder of your project. To create an Engine DDC PAK file, simply omit the `ProjectName` parameter.

:::note
If you are running your game as a foreign project (ie outside the Engine directory), you need to pass the path to the uproject file instead of the projet name.
:::

For more information, see Epic's documentation on [Creating a DDC PAK file](https://dev.epicgames.com/documentation/en-us/unreal-engine/using-derived-data-cache-in-unreal-engine).

## Cooking a Base Release for each platform

Cooking UGC as a DLC requires a reference Base Release in order to be cooked most effectively. For each platform that you wish to support, you will need to cook a base release and include it in the editor that you provide to mod.io.
You can cook a Base Release with the following commandline:

`RunUAT.bat BuildCookRun -Project=$(UProjectPath) -Platform=$(TargetPlatform) -nocompile -installed -utf8output -build -cook -CookCultures=en -unversionedcookedcontent -stage -createreleaseversion=UGCReleaseV1_0`

Ensure that the release version that you build and ship with corresponds to the release version that you use in the `-basedonreleaseversion` parameter in your `CookMod` BuildGraph script.

Below is an example of a BuildGraph script that you can incorporate into your build process to produce the base releases

```xml
<?xml version='1.0' ?>
<BuildGraph xmlns="http://www.epicgames.com/BuildGraph" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="./Schema.xsd">
    <!-- Global Params -->
    <Option Name="UProjectPath" DefaultValue="" Description="Path to the base project to reference"/>
    <Option Name="TargetPlatforms" Restrict="[^ ]*" DefaultValue="Win64" Description="List of the target platforms to build for, separated by semicolons, eg. Win64;Android"/>

    <Agent Name="Default Agent" Type="Default">
        <Node Name="CookReleaseVersions">
            <ForEach Name="TargetPlatform" Values="$(TargetPlatforms)">
                <Command Name="BuildCookRun" Arguments="-Project=$(UProjectPath) -Platform=$(TargetPlatform) -nocompile -installed -utf8output -build -cook -CookCultures=en -unversionedcookedcontent -stage -createreleaseversion=UGCReleaseV1_0" />    
            </ForEach>
        </Node>
    </Agent>
</BuildGraph>
```

:::note
You should also include the base release files when you ship your public editor to content creators.
:::

## Uploading your build and AutoSDKs to mod.io

As part of the onboarding process, you will get a SAS Token to connect to an Azure Storage Container to upload your build and SDKs. The only requirement for the file structure within this storage container is that your AutoSDKs are in a root folder called `AutoSDKs` and structured in line with Unreal Engine's AutoSDK structure. 

When you upload your AutoSDKs, please ensure that you omit the `OutputEnvVars.txt` file. This will ensure that the provisioning process automatically updates these files for the new build environment.

Your game/engine structure is up to you; however we recommend that your game is a subfolder of your Engine directory in line with Epic standards.
An example directory structure can be found below:

```
├── UnrealEngine
│   ├── Engine
│   │   ├── Binaries
│   │   ├── Config
│   │   ├── Content
│   │   ├── Plugins
│   │   ├── Source
│   │   ├── MyGame
│   │   │   ├── MyGame.uproject
│   │   │   └── ...
│   │   └── ...
├── AutoSDKs
│   └── HostWin64
│       ├── GDK
│       ├── PS4
│       └── ...
└── cloudcooking.config
```

The `cloudcooking.config` file is used to indicate to the build agent where it can locate RunUAT and your project file, relative to the root of this directory. It should be formatted as json.

### CloudCooking.config file

| Parameter Name    | Example Value | Description |
| -------- | -------- | ------- |
| EngineBuildDirectory  | /UnrealEngine/ | Path where the Engine folder can be found |
| GameProjectDirectory | /UnrealEngine/Engine/MyGame | Path to the directory of your game  |
| GameProjectName | MyGame.uproject | Filename of the uproject file for your game.  |

An example of the cloudcooking.config file for the above folder structure:

```json
{
    "EngineBuildDirectory" : "/UnrealEngine/" ,
    "GameProjectDirectory" : "/UnrealEngine/Engine/MyGame",
    "GameProjectName" : "MyGame"
}
```

:::note
Part of the Cloud Cooking provisioning process is to create a Virtual Machine image for faster build agent machine provisioning. These files are included in that image, and will be placed in a directory on main storage. You cannot assume what the location of these files will be. The provisioning process will automatically handle environment variables for Unreal Engine and the build agent.
:::

## Next steps

Now Cloud Cooking has been enabled for your game, head over to the [Cloud Cooking Configuration](https://docs.mod.io/cloud-cooking/configuration) guide to begin the onboarding process.